<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.clear3.mapper.TscPollutantcHourMapper">
    <resultMap id="BaseResultMap" type="org.example.clear3.domain.TscPollutantcHour">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="monitordate" jdbcType="TIMESTAMP" property="monitorDate"/>
        <id column="citycode" jdbcType="VARCHAR" property="cityCode"/>
        <id column="citytype" jdbcType="VARCHAR" property="cityType"/>
        <result column="so2_1h" jdbcType="NUMERIC" property="so21h"/>
        <result column="so2_1h_iaqi" jdbcType="NUMERIC" property="so21hIaqi"/>
        <result column="so2_1h_mask" jdbcType="VARCHAR" property="so21hMask"/>
        <result column="no2_1h" jdbcType="NUMERIC" property="no21h"/>
        <result column="no2_1h_iaqi" jdbcType="NUMERIC" property="no21hIaqi"/>
        <result column="no2_1h_mask" jdbcType="VARCHAR" property="no21hMask"/>
        <result column="pm10_1h" jdbcType="NUMERIC" property="pm101h"/>
        <result column="pm10_1h_iaqi" jdbcType="NUMERIC" property="pm101hIaqi"/>
        <result column="pm10_1h_mask" jdbcType="VARCHAR" property="pm101hMask"/>
        <result column="pm10_24h" jdbcType="NUMERIC" property="pm1024h"/>
        <result column="pm10_24h_iaqi" jdbcType="NUMERIC" property="pm1024hIaqi"/>
        <result column="pm10_24h_mask" jdbcType="VARCHAR" property="pm1024hMask"/>
        <result column="co_1h" jdbcType="NUMERIC" property="co1h"/>
        <result column="co_1h_iaqi" jdbcType="NUMERIC" property="co1hIaqi"/>
        <result column="co_1h_mask" jdbcType="VARCHAR" property="co1hMask"/>
        <result column="o3_1h" jdbcType="NUMERIC" property="o31h"/>
        <result column="o3_1h_iaqi" jdbcType="NUMERIC" property="o31hIaqi"/>
        <result column="o3_1h_mask" jdbcType="VARCHAR" property="o31hMask"/>
        <result column="o3_8h" jdbcType="NUMERIC" property="o38h"/>
        <result column="o3_8h_iaqi" jdbcType="NUMERIC" property="o38hIaqi"/>
        <result column="o3_8h_mask" jdbcType="VARCHAR" property="o38hMask"/>
        <result column="pm25_1h" jdbcType="NUMERIC" property="pm251h"/>
        <result column="pm25_1h_iaqi" jdbcType="NUMERIC" property="pm251hIaqi"/>
        <result column="pm25_1h_mask" jdbcType="VARCHAR" property="pm251hMask"/>
        <result column="pm25_24h" jdbcType="NUMERIC" property="pm2524h"/>
        <result column="pm25_24h_iaqi" jdbcType="NUMERIC" property="pm2524hIaqi"/>
        <result column="pm25_24h_mask" jdbcType="VARCHAR" property="pm2524hMask"/>
        <result column="aqi" jdbcType="NUMERIC" property="aqi"/>
        <result column="primary_pollutant" jdbcType="VARCHAR" property="primaryPollutant"/>
        <result column="aqi_level" jdbcType="VARCHAR" property="aqiLevel"/>
        <result column="aqi_mask" jdbcType="VARCHAR" property="aqiMask"/>
        <result column="no_1h" jdbcType="NUMERIC" property="no1h"/>
        <result column="no_1h_mask" jdbcType="VARCHAR" property="no1hMask"/>
        <result column="nox_1h" jdbcType="NUMERIC" property="nox1h"/>
        <result column="nox_1h_mask" jdbcType="VARCHAR" property="nox1hMask"/>
    </resultMap>


    <sql id="Base_Column_List">
        monitordate, citycode, citytype, so2_1h, so2_1h_iaqi, so2_1h_mask, no2_1h, no2_1h_iaqi,
        no2_1h_mask, pm10_1h, pm10_1h_iaqi, pm10_1h_mask, pm10_24h, pm10_24h_iaqi, pm10_24h_mask,
        co_1h, co_1h_iaqi, co_1h_mask, o3_1h, o3_1h_iaqi, o3_1h_mask, o3_8h, o3_8h_iaqi,
        o3_8h_mask, pm25_1h, pm25_1h_iaqi, pm25_1h_mask, pm25_24h, pm25_24h_iaqi, pm25_24h_mask,
        aqi, primary_pollutant, aqi_level, aqi_mask, no_1h, no_1h_mask, nox_1h, nox_1h_mask
    </sql>


    <select id="queryPollutionType" resultType="java.util.Map">
        SELECT
        tr.monitordate,
        tr.citycode,
        cr.cityname,
        <choose>
            <when test="params.target!=null">
                tr.${params.target},
                tr.${params.target}_mask
            </when>
            <otherwise>
                <include refid="Base_Column_List"></include>
            </otherwise>
        </choose>
        from t_sc_pollutant_c_hour tr LEFT JOIN city_weather_relation cr on tr.citycode = cr.citycode
        <where>
            <if test="params.cityCode!=null and params.cityCode!=''">
                tr.citycode in
                <foreach item="item" index="index" collection="params.cityCode.split(',')" open="(" separator=","
                         close=")">
                    #{item}
                </foreach>
            </if>
            <if test="params.beginTimeStr!=null and params.beginTimeStr!=''">
                and tr.monitordate&gt;=#{params.beginTimeStr}::TIMESTAMP
            </if>
            <if test="params.endTimeStr!=null and params.endTimeStr!=''">
                and tr.monitordate&lt;=#{params.endTimeStr}::TIMESTAMP
            </if>
            <if test="params.target!=null and params.target!=''">
                and tr.${params.target}_mask = 'yes'
            </if>

        </where>


    </select>
    <select id="timeCompareQuery" resultType="java.util.Map">
        SELECT
        cr.cityname,
        cr.citycode,
        COALESCE(to_char(tr.monitordate, 'YYYY-MM-DD HH24:MI:SS'),'-999') as monitordate,
        <choose>
            <when test="params.target!=null">
                COALESCE(tr.${params.target},'-999') AS ${params.target},
                COALESCE(tr.${params.target}_mask,'-999') AS ${params.target}_mask
            </when>
            <otherwise>
                <include refid="Base_Column_List"></include>
            </otherwise>
        </choose>
        FROM city_weather_relation cr
        LEFT JOIN (
        SELECT
        *
        FROM
        t_sc_pollutant_c_hour
        <where>
            <if test="params.cityCode!=null and params.cityCode!=''">
                citycode in
                <foreach item="item" index="index" collection="params.cityCode.split(',')" open="(" separator=","
                         close=")">
                    #{item}
                </foreach>
            </if>
            <if test="params.beginTimeStr!=null and params.beginTimeStr!=''">
                and monitordate&gt;=#{params.beginTimeStr}::TIMESTAMP
            </if>
            <if test="params.endTimeStr!=null and params.endTimeStr!=''">
                and monitordate&lt;=#{params.endTimeStr}::TIMESTAMP
            </if>
            <if test="params.target!=null and params.target!=''">
                and ${params.target}_mask = 'yes'
            </if>
        </where>
        ) tr ON tr.citycode = cr.citycode
        <where>
            <if test="params.cityCode!=null and params.cityCode!=''">
                cr.citycode in
                <foreach item="item" index="index" collection="params.cityCode.split(',')" open="(" separator=","
                         close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>


    <select id="queryDayAverage" resultType="java.util.Map">
        SELECT
        <choose>
            <when test="params.target!=null">
                ${params.target}
            </when>
            <otherwise>
                <include refid="Base_Column_List"></include>
            </otherwise>
        </choose>
        FROM
        t_sc_pollutant_c_hour
        <where>
            <if test="params.cityCode!=null and params.cityCode!=''">
                citycode in
                <foreach item="item" index="index" collection="params.cityCode.split(',')" open="(" separator=","
                         close=")">
                    #{item}
                </foreach>
            </if>
            <if test="params.target!=null and params.target!=''">
                <foreach item="item" index="index" collection="params.target.split(',')" separator="" open="" close="">
                    AND ${item}_mask = 'yes'
                </foreach>
            </if>
            <if test="params.beginTimeStr!=null and params.beginTimeStr!=''">
                AND monitordate&gt;=#{params.beginTimeStr}::TIMESTAMP
            </if>
            <if test="params.endTimeStr!=null and params.endTimeStr!=''">
                AND monitordate&lt;=#{params.endTimeStr}::TIMESTAMP
            </if>


        </where>

    </select>
</mapper>